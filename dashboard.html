<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIverse Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        :root {
            --bg-color: #0f172a;
            --text-color: #e2e8f0;
            --card-bg: #1e293b;
            --accent-color: #60a5fa;
            --button-bg: #2563eb;
            --button-hover: #1d4ed8;
            --search-bg: #334155;
            --hover-bg: #334155;
            --border-color: #334155;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        body.light {
            --bg-color: #f1f5f9;
            --text-color: #1f2937;
            --card-bg: #ffffff;
            --accent-color: #3b82f6;
            --button-bg: #3b82f6;
            --button-hover: #2563eb;
            --search-bg: #e2e8f0;
            --hover-bg: #e2e8f0;
            --border-color: #e2e8f0;
        }

        .navbar {
            background-color: var(--card-bg);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-container img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .navbar h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            color: var(--accent-color);
        }

        .search-bar {
            width: 35%;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 0.8rem 1rem;
            border-radius: 0.5rem;
            background-color: var(--search-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            outline: none;
            font-size: 1rem;
        }

        .search-bar input:focus {
            box-shadow: 0 0 0 2px var(--accent-color);
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        .suggestions.active {
            display: block;
        }

        .suggestions div {
            padding: 0.8rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .suggestions div:hover {
            background-color: var(--hover-bg);
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-container {
            position: relative;
        }

        .notification-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.4rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .notification-btn:hover {
            color: var(--accent-color);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ef4444;
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 50%;
            min-width: 20px;
            text-align: center;
        }

        .notification-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            width: 350px;
            background-color: var(--card-bg);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            z-index: 1000;
            margin-top: 0.5rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-dropdown.active {
            display: block;
        }

        .notification-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h3 {
            color: var(--accent-color);
            font-size: 1.2rem;
            margin: 0;
        }

        .notification-header button {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }

        .notification-item.unread {
            background-color: rgba(99, 102, 241, 0.1);
        }

        .notification-title {
            color: var(--accent-color);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .notification-message {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .notification-time {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.4rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
        }

        .theme-toggle:hover {
            background-color: var(--hover-bg);
        }

        .user-profile {
            position: relative;
        }

        .user-profile button {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.4rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
        }

        .user-profile button:hover {
            background-color: var(--hover-bg);
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--card-bg);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            width: 280px;
            padding: 1.5rem;
            z-index: 1000;
            border: 1px solid var(--border-color);
        }

        .user-dropdown.active {
            display: block;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            background-color: var(--bg-color);
            position: relative;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .fallback-avatar {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            color: var(--accent-color);
        }

        .user-details h4 {
            color: var(--accent-color);
            font-size: 1.1rem;
        }

        .user-details p {
            color: var(--text-color);
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .user-actions a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            color: var(--text-color);
            text-decoration: none;
            border-radius: 0.5rem;
        }

        .user-actions a:hover {
            background-color: var(--hover-bg);
            color: var(--accent-color);
        }

        .user-actions a#userLogout {
            color: #ef4444;
        }

        .sidebar-toggle {
            display: none;
            font-size: 1.5rem;
            color: var(--text-color);
            cursor: pointer;
        }

        .sidebar {
            width: 280px;
            background-color: var(--card-bg);
            padding: 1.5rem;
            height: calc(100vh - 60px);
            position: fixed;
            top: 60px;
            left: 0;
            overflow-y: auto;
            transition: transform 0.3s;
        }

        .sidebar h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar ul li a {
            color: var(--text-color);
            text-decoration: none;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 1rem;
            border-radius: 0.5rem;
        }

        .sidebar ul li a:hover {
            background-color: var(--hover-bg);
            color: var(--accent-color);
        }

        .sidebar ul li a i {
            font-size: 1.2rem;
            width: 24px;
            color: var(--accent-color);
        }

        .container {
            flex: 1;
            display: flex;
        }

        .main-content {
            margin-left: 280px;
            padding: 2rem;
            width: calc(100% - 280px);
            margin-top: 60px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .stat-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--accent-color);
        }

        .stat-card p {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .chart-container, .analytics-card {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .chart-container h3, .analytics-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .api-grid, .user-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .api-card, .user-card {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            transition: transform 0.3s;
        }

        .api-card:hover, .user-card:hover {
            transform: translateY(-5px);
        }

        .api-card h3, .user-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4rem;
            margin-bottom: 0.5rem;
            color: var(--accent-color);
        }

        .api-card p, .user-card p {
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
        }

        .api-card .buttons, .user-card .buttons {
            display: flex;
            gap: 0.5rem;
        }

        .api-card button, .user-card button {
            background-color: var(--button-bg);
            color: #fff;
            padding: 0.6rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .api-card button.delete-btn, .user-card button.delete-btn {
            background-color: #ef4444;
        }

        .api-card button:hover, .user-card button:hover {
            background-color: var(--button-hover);
        }

        .api-card button.delete-btn:hover, .user-card button.delete-btn:hover {
            background-color: #dc2626;
        }

        .add-api-btn {
            background-color: var(--button-bg);
            color: #fff;
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        .add-api-btn:hover {
            background-color: var(--button-hover);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 1rem;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            color: var(--accent-color);
            font-size: 1.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .close-btn:hover {
            color: var(--accent-color);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--search-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.9rem;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .btn-primary {
            background-color: var(--button-bg);
            color: #fff;
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
        }

        .btn-primary:hover {
            background-color: var(--button-hover);
        }

        footer {
            background: var(--bg-color);
            color: var(--text-color);
            padding: 4rem 2rem 2rem;
            margin-top: 4rem;
            border-top: 1px solid var(--border-color);
            width: calc(100% - 280px);
            margin-left: 280px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 3rem;
        }

        .footer-main {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .footer-logo img {
            width: 50px;
            height: 50px;
        }

        .footer-logo h2 {
            font-size: 2rem;
            color: var(--accent-color);
        }

        .footer-description {
            opacity: 0.8;
            line-height: 1.6;
        }

        .footer-links {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
        }

        .footer-section h3 {
            color: var(--accent-color);
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li a {
            color: var(--text-color);
            text-decoration: none;
        }

        .footer-section ul li a:hover {
            color: var(--accent-color);
        }

        .social-links {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .social-icon {
            color: var(--text-color);
            font-size: 1.5rem;
        }

        .social-icon:hover {
            color: var(--accent-color);
        }

        .contact-info p {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        .contact-info i {
            color: var(--accent-color);
        }

        .footer-bottom {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-legal {
            display: flex;
            gap: 1.5rem;
        }

        .footer-legal a {
            color: var(--text-color);
            text-decoration: none;
            opacity: 0.8;
        }

        .footer-legal a:hover {
            color: var(--accent-color);
            opacity: 1;
        }

        @media (max-width: 1024px) {
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .sidebar-toggle {
                display: block;
            }
            footer {
                margin-left: 0;
                width: 100%;
            }
            .footer-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .footer-links {
                grid-template-columns: 1fr;
            }
            .stats-grid, .analytics-grid {
                grid-template-columns: 1fr;
            }
            .search-bar {
                width: 50%;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo-container">
            <img src="assets/title-logo.png" alt="Apiverse Logo" class="logo-img" onerror="this.style.display='none'">
            <h1>APIverse Admin</h1>
        </div>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search APIs or Users..." oninput="filterDashboard()">
            <div class="suggestions" id="suggestions"></div>
        </div>
        <div class="nav-links">
            <div class="notification-container">
                <button class="notification-btn" onclick="toggleNotificationDropdown()">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationBadge">0</span>
                </button>
                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="notification-header">
                        <h3>Notifications</h3>
                        <button onclick="markAllAsRead()">Mark all as read</button>
                    </div>
                    <div class="notification-list" id="notificationList"></div>
                </div>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">
                <i class="fas fa-moon"></i>
            </button>
            <div class="user-profile">
                <button onclick="toggleUserDropdown()">
                    <i class="fas fa-user"></i>
                </button>
                <div class="user-dropdown" id="userDropdown">
                    <div class="user-info">
                        <div class="user-avatar">
                            <img src="assets/user-avatar.png" alt="User Avatar" id="userAvatar" onerror="this.style.display='none'">
                            <div class="fallback-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                        </div>
                        <div class="user-details">
                            <h4 id="userName">Loading...</h4>
                            <p id="userEmail">Loading...</p>
                        </div>
                    </div>
                    <div class="user-actions">
                        <a href="#" id="userSettings"><i class="fas fa-cog"></i> Settings</a>
                        <a href="#" id="userHelp"><i class="fas fa-question-circle"></i> Help</a>
                        <a href="#" id="userLogout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="sidebar-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
    </nav>

    <div class="container">
        <aside class="sidebar" id="sidebar">
            <h2><i class="fas fa-compass"></i> Navigation</h2>
            <ul>
                <li><a href="#" onclick="showSection('overview')"><i class="fas fa-home"></i> Overview</a></li>
                <li><a href="#" onclick="showSection('api-management')"><i class="fas fa-plug"></i> API Management</a></li>
                <li><a href="#" onclick="showSection('user-management')"><i class="fas fa-users"></i> User Management</a></li>
                <li><a href="#" onclick="showSection('analytics')"><i class="fas fa-chart-bar"></i> Analytics</a></li>
                <li><a href="home.html"><i class="fas fa-globe"></i> Back to Home</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <section id="overview" class="section active">
                <h2><i class="fas fa-home"></i> Dashboard Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total APIs</h3>
                        <p id="totalApis">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Active Users</h3>
                        <p id="activeUsers">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>API Calls Today</h3>
                        <p id="apiCalls">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Security Alerts</h3>
                        <p id="securityAlerts">0</p>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>API Usage Over Time</h3>
                    <canvas id="usageChart"></canvas>
                </div>
            </section>

            <section id="api-management" class="section">
                <h2><i class="fas fa-plug"></i> API Management</h2>
                <button class="add-api-btn" onclick="openAddAPIModal()">Add New API</button>
                <div class="api-grid" id="apiGrid"></div>
            </section>

            <section id="user-management" class="section">
                <h2><i class="fas fa-users"></i> User Management</h2>
                <div class="user-grid" id="userGrid"></div>
            </section>

            <section id="analytics" class="section">
                <h2><i class="fas fa-chart-bar"></i> Analytics</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Top APIs by Usage</h3>
                        <canvas id="topApisChart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>User Activity</h3>
                        <canvas id="userActivityChart"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div class="modal" id="addAPIModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New API</h3>
                <button class="close-btn" onclick="closeAddAPIModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="addAPIForm">
                    <div class="form-group">
                        <label for="apiName">API Name</label>
                        <input type="text" id="apiName" required>
                    </div>
                    <div class="form-group">
                        <label for="apiDescription">Description</label>
                        <textarea id="apiDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="apiLanguages">Languages (comma-separated)</label>
                        <input type="text" id="apiLanguages" required>
                    </div>
                    <div class="form-group">
                        <label for="apiCategory">Category</label>
                        <select id="apiCategory" required>
                            <option value="Weather">Weather</option>
                            <option value="News">News</option>
                            <option value="Payment">Payment</option>
                            <option value="Communication">Communication</option>
                            <option value="Geolocation">Geolocation</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Development">Development</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="apiTrustScore">Trust Score (0-10)</label>
                        <input type="number" id="apiTrustScore" min="0" max="10" step="0.1" required>
                    </div>
                    <button type="submit" class="btn-primary">Add API</button>
                </form>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-main">
                <div class="footer-logo">
                    <img src="assets/title-logo.png" alt="Apiverse Logo" class="logo-img" onerror="this.style.display='none'">
                    <h2>Apiverse</h2>
                </div>
                <p class="footer-description">Your gateway to the world of APIs. Discover, integrate, and innovate.</p>
            </div>
            <div class="footer-links">
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#overview">Overview</a></li>
                        <li><a href="#api-management">API Management</a></li>
                        <li><a href="#user-management">User Management</a></li>
                        <li><a href="#analytics">Analytics</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="#tutorials">Tutorials</a></li>
                        <li><a href="#blog">Blog</a></li>
                        <li><a href="#support">Support</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Connect With Us</h3>
                    <div class="social-links">
                        <a href="#" class="social-icon"><i class="fab fa-github"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-linkedin"></i></a>
                    </div>
                    <div class="contact-info">
                        <p><i class="fas fa-envelope"></i> support@apiverse.com</p>
                        <p><i class="fas fa-phone"></i> +923042507846</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 Apiverse. All rights reserved.</p>
            <div class="footer-legal">
                <a href="#privacy">Privacy Policy</a>
                <a href="#terms">Terms of Service</a>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
   <script>
    // Firebase Initialization
const firebaseConfig = {
    apiKey: "AIzaSyA6jaYK4e7LFtqzycT-KO5sDYi7ipWf4oA",
  authDomain: "api-verse-dc2bc.firebaseapp.com",
  projectId: "api-verse-dc2bc",
  storageBucket: "api-verse-dc2bc.appspot.com",  // corrected from firebasestorage.app
  messagingSenderId: "692038670622",
  appId: "1:692038670622:web:3ed37cf8f741078bb8910f",
  measurementId: "G-9YF1DR0SFZ"
};

let auth, db;
try {
    const app = firebase.initializeApp(firebaseConfig);
    auth = firebase.auth();
    db = firebase.firestore();
} catch (error) {
    console.error('Firebase initialization failed:', error);
    alert('Please configure Firebase credentials in firebaseConfig');
}

// Dummy API Data
const apiData = [
    { name: "OpenWeatherMap", description: "Weather data API", languages: ["JavaScript", "Python"], category: "Weather", trustScore: 8.5 },
    { name: "NewsAPI", description: "Live news feeds", languages: ["Python", "Java"], category: "News", trustScore: 7.8 }
];

// Firestore User Management
let userData = [];

async function fetchUsers() {
    try {
        const usersCollection = db.collection("users");
        const userSnapshot = await usersCollection.get();
        userData = userSnapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
        }));
        renderUserCards();
        updateStats();
    } catch (error) {
        console.error('Error fetching users:', error);
        // Fallback to dummy data
        userData = [
            { id: '1', name: "Ali Khan", email: "ali@example.com", role: "User", status: "Active" },
            { id: '2', name: "Sara Ahmed", email: "sara@example.com", role: "User", status: "Inactive" }
        ];
        renderUserCards();
    }
}

async function addUser(user) {
    try {
        const usersCollection = db.collection("users");
        const docRef = await usersCollection.add(user);
        userData.push({ id: docRef.id, ...user });
        renderUserCards();
        updateStats();
        addNotification('User Added', `${user.name} added successfully`);
    } catch (error) {
        console.error('Error adding user:', error);
        alert('Failed to add user');
    }
}

async function updateUser(userId, updatedUser) {
    try {
        const userDoc = db.collection("users").doc(userId);
        await userDoc.update(updatedUser);
        userData = userData.map(u => u.id === userId ? { id: userId, ...updatedUser } : u);
        renderUserCards();
        updateStats();
        addNotification('User Updated', `${updatedUser.name} updated successfully`);
    } catch (error) {
        console.error('Error updating user:', error);
        alert('Failed to update user');
    }
}

async function deleteUser(userId) {
    try {
        const userDoc = db.collection("users").doc(userId);
        const user = userData.find(u => u.id === userId);
        await userDoc.delete();
        userData = userData.filter(u => u.id !== userId);
        renderUserCards();
        updateStats();
        addNotification('User Deleted', `${user.name} deleted`);
    } catch (error) {
        console.error('Error deleting user:', error);
        alert('Failed to delete user');
    }
}

// Dashboard State
let displayedAPIs = [...apiData];
let displayedUsers = [...userData];
let notifications = [];
let unreadCount = 0;

// Authentication Check
auth.onAuthStateChanged(user => {
    try {
        if (user && user.email === "admin@gmail.com") {
            document.getElementById('userName').textContent = user.displayName || "Admin";
            document.getElementById('userEmail').textContent = user.email;
            initializeDashboard();
        } else {
            console.warn('No admin user logged in');
            alert('Please log in as admin');
            window.location.href = "index.html";
        }
    } catch (error) {
        console.error('Auth state change error:', error);
    }
});

// Initialize Dashboard
function initializeDashboard() {
    try {
        fetchUsers();
        updateStats();
        renderAPICards();
        initializeCharts();
        addNotification("Welcome", "Welcome to the APIverse Admin Dashboard!");
        updateUserDropdown();
    } catch (error) {
        console.error('Dashboard initialization failed:', error);
    }
}

// Update Stats
function updateStats() {
    try {
        document.getElementById('totalApis').textContent = apiData.length;
        document.getElementById('activeUsers').textContent = userData.filter(u => u.status === "Active").length;
        document.getElementById('apiCalls').textContent = Math.floor(Math.random() * 2000);
        document.getElementById('securityAlerts').textContent = Math.floor(Math.random() * 5);
    } catch (error) {
        console.error('Update stats failed:', error);
    }
}

// Render API Cards
function renderAPICards() {
    try {
        const apiGrid = document.getElementById('apiGrid');
        apiGrid.innerHTML = displayedAPIs.length ? '' : '<p>No APIs found</p>';
        displayedAPIs.forEach(api => {
            apiGrid.innerHTML += `
                <div class="api-card">
                    <h3>${api.name}</h3>
                    <p>${api.description}</p>
                    <p>Languages: ${api.languages.join(', ')}</p>
                    <p>Category: ${api.category}</p>
                    <div class="buttons">
                        <button onclick="editAPI('${api.name}')">Edit</button>
                        <button class="delete-btn" onclick="deleteAPI('${api.name}')">Delete</button>
                    </div>
                </div>
            `;
        });
    } catch (error) {
        console.error('Render API cards failed:', error);
    }
}

// Render User Cards
function renderUserCards() {
    try {
        const userGrid = document.getElementById('userGrid');
        userGrid.innerHTML = displayedUsers.length ? '' : '<p>No users found</p>';
        displayedUsers = [...userData]; // Update displayed users
        displayedUsers.forEach(user => {
            userGrid.innerHTML += `
                <div class="user-card">
                    <h3>${user.name}</h3>
                    <p>Email: ${user.email}</p>
                    <p>Role: ${user.role}</p>
                    <p>Status: ${user.status}</p>
                    <div class="buttons">
                        <button onclick="editUser('${user.id}')">Edit</button>
                        <button class="delete-btn" onclick="deleteUser('${user.id}')">Delete</button>
                    </div>
                </div>
            `;
        });
    } catch (error) {
        console.error('Render user cards failed:', error);
    }
}

// Filter Dashboard
function filterDashboard() {
    try {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const suggestions = document.getElementById('suggestions');
        displayedAPIs = apiData.filter(api =>
            api.name.toLowerCase().includes(search) ||
            api.description.toLowerCase().includes(search)
        );
        displayedUsers = userData.filter(user =>
            user.name.toLowerCase().includes(search) ||
            user.email.toLowerCase().includes(search)
        );

        suggestions.innerHTML = '';
        if (search) {
            const combined = [
                ...displayedAPIs.map(api => ({ type: 'API', name: api.name })),
                ...displayedUsers.map(user => ({ type: 'User', name: user.name }))
            ].slice(0, 5);
            combined.forEach(item => {
                const div = document.createElement('div');
                div.textContent = `${item.type}: ${item.name}`;
                div.onclick = () => {
                    document.getElementById('searchInput').value = item.name;
                    filterDashboard();
                };
                suggestions.appendChild(div);
            });
            suggestions.classList.add('active');
        } else {
            suggestions.classList.remove('active');
        }

        renderAPICards();
        renderUserCards();
    } catch (error) {
        console.error('Filter dashboard failed:', error);
    }
}

// Show Section
function showSection(sectionId) {
    try {
        document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        document.getElementById('sidebar').classList.remove('active');
    } catch (error) {
        console.error('Show section failed:', error);
    }
}

// Toggle Sidebar
function toggleSidebar() {
    try {
        document.getElementById('sidebar').classList.toggle('active');
    } catch (error) {
        console.error('Toggle sidebar failed:', error);
    }
}

// Toggle Theme
function toggleTheme() {
    try {
        document.body.classList.toggle('light');
        const icon = document.querySelector('.theme-toggle i');
        icon.classList.toggle('fa-moon');
        icon.classList.toggle('fa-sun');
    } catch (error) {
        console.error('Toggle theme failed:', error);
    }
}

// Toggle User Dropdown
function toggleUserDropdown() {
    try {
        document.getElementById('userDropdown').classList.toggle('active');
    } catch (error) {
        console.error('Toggle user dropdown failed:', error);
    }
}

// Update User Dropdown
function updateUserDropdown() {
    try {
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const userAction = document.getElementById('userLogout');
        const userSettings = document.getElementById('userSettings');
        const userHelp = document.getElementById('userHelp');

        const user = auth.currentUser;
        if (user) {
            userName.textContent = user.displayName || 'Admin';
            userEmail.textContent = user.email;
            userAction.textContent = 'Logout';
            userAction.onclick = logout;
            userSettings.onclick = () => alert('Settings page coming soon!');
            userHelp.onclick = () => alert('Help & Support page coming soon!');
        } else {
            userName.textContent = 'Not logged in';
            userEmail.textContent = 'Please login to view your profile';
            userAction.textContent = 'Login';
            userAction.onclick = () => window.location.href = "index.html";
            userSettings.style.display = 'none';
            userHelp.style.display = 'none';
        }
    } catch (error) {
        console.error('Update user dropdown failed:', error);
    }
}

// Notifications
function toggleNotificationDropdown() {
    try {
        document.getElementById('notificationDropdown').classList.toggle('active');
    } catch (error) {
        console.error('Toggle notification dropdown failed:', error);
    }
}

function addNotification(title, message) {
    try {
        notifications.unshift({
            id: Date.now(),
            title,
            message,
            time: new Date(),
            read: false
        });
        unreadCount++;
        renderNotifications();
        updateNotificationBadge();
    } catch (error) {
        console.error('Add notification failed:', error);
    }
}

function renderNotifications() {
    try {
        const list = document.getElementById('notificationList');
        list.innerHTML = notifications.length ? '' : '<div class="notification-item">No notifications</div>';
        notifications.forEach(n => {
            list.innerHTML += `
                <div class="notification-item ${n.read ? '' : 'unread'}" onclick="markAsRead(${n.id})">
                    <div class="notification-title">${n.title}</div>
                    <div class="notification-message">${n.message}</div>
                    <div class="notification-time">${formatTime(n.time)}</div>
                </div>
            `;
        });
    } catch (error) {
        console.error('Render notifications failed:', error);
    }
}

function markAsRead(id) {
    try {
        const notification = notifications.find(n => n.id === id);
        if (notification && !notification.read) {
            notification.read = true;
            unreadCount--;
            renderNotifications();
            updateNotificationBadge();
        }
    } catch (error) {
        console.error('Mark as read failed:', error);
    }
}

function markAllAsRead() {
    try {
        notifications.forEach(n => n.read = true);
        unreadCount = 0;
        renderNotifications();
        updateNotificationBadge();
    } catch (error) {
        console.error('Mark all as read failed:', error);
    }
}

function updateNotificationBadge() {
    try {
        const badge = document.getElementById('notificationBadge');
        badge.textContent = unreadCount;
        badge.style.display = unreadCount ? 'block' : 'none';
    } catch (error) {
        console.error('Update notification badge failed:', error);
    }
}

function formatTime(date) {
    try {
        const diff = (new Date() - date) / 60000;
        if (diff < 1) return 'Just now';
        if (diff < 60) return `${Math.floor(diff)}m ago`;
        return `${Math.floor(diff / 60)}h ago`;
    } catch (error) {
        console.error('Format time failed:', error);
        return '';
    }
}

// Modal
function openAddAPIModal() {
    try {
        document.getElementById('addAPIModal').style.display = 'flex';
    } catch (error) {
        console.error('Open add API modal failed:', error);
    }
}

function closeAddAPIModal() {
    try {
        document.getElementById('addAPIModal').style.display = 'none';
        document.getElementById('addAPIForm').reset();
    } catch (error) {
        console.error('Close add API modal failed:', error);
    }
}

function openAddUserModal() {
    try {
        document.getElementById('addUserModal').style.display = 'flex';
    } catch (error) {
        console.error('Open add user modal failed:', error);
    }
}

function closeAddUserModal() {
    try {
        document.getElementById('addUserModal').style.display = 'none';
        document.getElementById('addUserForm').reset();
    } catch (error) {
        console.error('Close add user modal failed:', error);
    }
}

function openEditUserModal(userId) {
    try {
        const user = userData.find(u => u.id === userId);
        if (user) {
            document.getElementById('editUserId').value = user.id;
            document.getElementById('editUserName').value = user.name;
            document.getElementById('editUserEmail').value = user.email;
            document.getElementById('editUserRole').value = user.role;
            document.getElementById('editUserStatus').value = user.status;
            document.getElementById('editUserModal').style.display = 'flex';
        }
    } catch (error) {
        console.error('Open edit user modal failed:', error);
    }
}

function closeEditUserModal() {
    try {
        document.getElementById('editUserModal').style.display = 'none';
        document.getElementById('editUserForm').reset();
    } catch (error) {
        console.error('Close edit user modal failed:', error);
    }
}

// Add API
document.getElementById('addAPIForm').addEventListener('submit', e => {
    try {
        e.preventDefault();
        const newAPI = {
            name: document.getElementById('apiName').value,
            description: document.getElementById('apiDescription').value,
            languages: document.getElementById('apiLanguages').value.split(',').map(l => l.trim()),
            category: document.getElementById('apiCategory').value,
            trustScore: parseFloat(document.getElementById('apiTrustScore').value)
        };
        apiData.push(newAPI);
        displayedAPIs = [...apiData];
        renderAPICards();
        updateStats();
        addNotification('API Added', `${newAPI.name} added successfully`);
        closeAddAPIModal();
    } catch (error) {
        console.error('Add API failed:', error);
    }
});

// Add User
document.getElementById('addUserForm').addEventListener('submit', async e => {
    try {
        e.preventDefault();
        const newUser = {
            name: document.getElementById('userName').value,
            email: document.getElementById('userEmail').value,
            role: document.getElementById('userRole').value,
            status: document.getElementById('userStatus').value
        };
        await addUser(newUser);
        closeAddUserModal();
    } catch (error) {
        console.error('Add user failed:', error);
    }
});

// Edit User
document.getElementById('editUserForm').addEventListener('submit', async e => {
    try {
        e.preventDefault();
        const userId = document.getElementById('editUserId').value;
        const updatedUser = {
            name: document.getElementById('editUserName').value,
            email: document.getElementById('editUserEmail').value,
            role: document.getElementById('editUserRole').value,
            status: document.getElementById('editUserStatus').value
        };
        await updateUser(userId, updatedUser);
        closeEditUserModal();
    } catch (error) {
        console.error('Edit user failed:', error);
    }
});

// Edit/Delete APIs
function editAPI(name) {
    try {
        alert(`Editing ${name} (Implement modal for editing)`);
    } catch (error) {
        console.error('Edit API failed:', error);
    }
}

function deleteAPI(name) {
    try {
        if (confirm(`Delete ${name}?`)) {
            apiData = apiData.filter(api => api.name !== name);
            displayedAPIs = [...apiData];
            renderAPICards();
            updateStats();
            addNotification('API Deleted', `${name} removed`);
        }
    } catch (error) {
        console.error('Delete API failed:', error);
    }
}

// Edit/Delete Users
window.editUser = function(userId) {
    openEditUserModal(userId);
};

window.deleteUser = function(userId) {
    if (confirm(`Delete user?`)) {
        deleteUser(userId);
    }
};

// Charts
function initializeCharts() {
    try {
        if (!window.Chart) {
            console.error('Chart.js not loaded');
            return;
        }

        new Chart(document.getElementById('usageChart'), {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'API Calls',
                    data: [500, 700, 600, 800, 900, 1000],
                    borderColor: '#60a5fa',
                    fill: false
                }]
            },
            options: { responsive: true, scales: { y: { beginAtZero: true } } }
        });

        new Chart(document.getElementById('topApisChart'), {
            type: 'bar',
            data: {
                labels: apiData.map(api => api.name).slice(0, 5),
                datasets: [{
                    label: 'Usage',
                    data: apiData.map(() => Math.random() * 1000).slice(0, 5),
                    backgroundColor: '#60a5fa'
                }]
            },
            options: { responsive: true, scales: { y: { beginAtZero: true } } }
        });

        new Chart(document.getElementById('userActivityChart'), {
            type: 'doughnut',
            data: {
                labels: ['Active', 'Inactive'],
                datasets: [{
                    data: [
                        userData.filter(u => u.status === 'Active').length || 1,
                        userData.filter(u => u.status === 'Inactive').length || 1
                    ],
                    backgroundColor: ['#60a5fa', '#ef4444']
                }]
            },
            options: { responsive: true }
        });
    } catch (error) {
        console.error('Initialize charts failed:', error);
    }
}

// Logout
function logout() {
    try {
        auth.signOut().then(() => {
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }).catch(error => {
            console.error('Logout failed:', error);
            alert('Error logging out');
        });
    } catch (error) {
        console.error('Logout failed:', error);
    }
}

// Close Dropdowns
document.addEventListener('click', e => {
    try {
        if (!e.target.closest('.search-bar')) document.getElementById('suggestions').classList.remove('active');
        if (!e.target.closest('.user-profile')) document.getElementById('userDropdown').classList.remove('active');
        if (!e.target.closest('.notification-container')) document.getElementById('notificationDropdown').classList.remove('active');
    } catch (error) {
        console.error('Close dropdowns failed:', error);
    }
});

// Initialize Page
document.addEventListener('DOMContentLoaded', () => {
    try {
        const searchInput = document.querySelector('.search-bar input');
        const suggestions = document.querySelector('.suggestions');
        if (searchInput && suggestions) {
            searchInput.addEventListener('input', filterDashboard);
        }
    } catch (error) {
        console.error('Page initialization failed:', error);
    }
});
   </script>
</body>
</html>